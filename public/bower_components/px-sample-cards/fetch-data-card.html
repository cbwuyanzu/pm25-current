<link rel="import" href="../polymer/polymer.html" />
<link rel="import" href="../px-card/px-card.html" />

<dom-module id="fetch-data-card">
    <link rel="import" type="css" href="css/px-sample-cards.css" />
    <style>
        .temp--box {
            border: 1px solid #d1d0d8;
            padding: 0 20px 20px 20px;
            margin: 10px;
        }

        .more-info {
            padding: 0 10px;
        }

        .more-info h2 a {
            font-size: 14px;
            margin-left: 10px;
        }

        .temp-box-container {
            width: 80%;
            margin: 0 auto;
        }

        .center {
            text-align: center;
        }

        .temperature-box button {
            margin-bottom: 25px;
        }

        .temperature-box h1 {
            font-size: 32px;
        }

        .summary-label {
            color: white;
            font-size: 17px;
            margin: 0;
            padding-top: 8px;
            padding-bottom: 0;
            text-overflow: ellipsis;
            overflow: hidden;
            white-space: nowrap;
        }

        .summary-value {
            color: white;
            font-size: 40px;
            font-weight: bold;
        }

        .summary-box {
            padding-left: 50px !important;
        }

        .summary-uom {
            color: lightgray;
            font-size: 20px;
            font-weight: bold;
        }

        .rmd-legend {
            padding-left: 20px !important;
        }
    </style>
    <template>
        <px-card header-text="Driver asset management">
            <div>
                <button class="btn btn--large btn--primary" on-click="refreshData">Refresh Data</button>
            </div>
        </px-card>
        <!-- <div class="layout center temperature-box">
        <div class="layout__item">
          <h2 class="summary-label caps">CTP indoor : <span>{{currentTemperature}}</h2> <h2>CTP outdoor : <span>{{currentPm25Out}}</h2>
        </div>
      </div> -->
        <div class="layout layout--right">
            <div class="layout__item u-1/6 summary-box" style="float:left">
                <h4 class="summary-label caps">Voltage in: </h4>
                <div>
                    <span class="summary-value" style={{incolors}}>{{currentTemperature}}</span>
                    <span class="summary-uom">V</span>
                </div>
            </div>
            <div class="layout__item u-1/6 summary-box" style="float:left">
                <h4 class="summary-label caps">Current in: </h4>
                <div>
                    <span class="summary-value" style={{inIcolors}}>{{currentIn}}</span>
                    <span class="summary-uom">mA</span>
                </div>
            </div>
            <div class="layout__item u-1/6 summary-box" style="float:left">
                <h4 class="summary-label caps">Voltage out: </h4>
                <div>
                    <span class="summary-value" style={{outcolors}}>{{currentPm25Out}}</span>
                    <span class="summary-uom">V</span>
                </div>
            </div>
            <div class="layout__item u-1/6 summary-box" style="float:left">
                <h4 class="summary-label caps">Current out: </h4>
                <div>
                    <span class="summary-value" style={{outIcolors}}>{{currentOut}}</span>
                    <span class="summary-uom">mA</span>
                </div>
            </div>
        </div>
    </template>
</dom-module>

<script>
    Polymer({
        is: 'fetch-data-card',
        init: function() {
            this.getTemperature();
            this.getOutdoor();
            this.getCurrentIn();
            this.getCurrentOut();
        },
        refreshData: function() {
            this.getTemperature();
            this.getOutdoor();
            this.getCurrentIn();
            this.getCurrentOut();
        },
        getTemperature: function() {
            /**
             * use card's getData api to get the temperature data
             * using the URL from context
             **/
            var self = this;
            // this.getData(this.context.urls['weather-data'],{headers: {'my-header-name': 'my-header-value'}}).then(function(data) {
            this.getData(this.context.urls[0].url).then(function(data) {
                // following data structure from http://api.wunderground.com/
                self.currentTemperature = data.tags[0].results[0].values[0][1];
                self.incolors = self.getColor(self.currentTemperature);
                // self.heiheihei = "summary-value";
            }, function(reason) {
                // on rejection
                console.error('ERROR', reason);
                self.currentTemperature = '--';
            });
        },
        getOutdoor: function() {
            /**
             * use card's getData api to get the temperature data
             * using the URL from context
             **/
            var self = this;
            // this.getData(this.context.urls['weather-data'],{headers: {'my-header-name': 'my-header-value'}}).then(function(data) {
            this.getData(this.context.urls[1].url).then(function(data) {
                // following data structure from  http://api.wunderground.com/
                self.currentPm25Out = data.tags[0].results[0].values[0][1];
                self.outcolors = self.getColor(self.currentPm25Out);
            }, function(reason) {
                // on rejection
                console.error('ERROR', reason);
                self.currentPm25Out = '--';
            });
        },
        getCurrentIn: function() {
            /**
             * use card's getData api to get the temperature data
             * using the URL from context
             **/
            var self = this;
            // this.getData(this.context.urls['weather-data'],{headers: {'my-header-name': 'my-header-value'}}).then(function(data) {
            this.getData(this.context.urls[2].url).then(function(data) {
                // following data structure from http://api.wunderground.com/
                self.currentIn = data.tags[0].results[0].values[0][1];
                self.inIcolors = self.getColor(self.currentIn);
                // self.heiheihei = "summary-value";
            }, function(reason) {
                // on rejection
                console.error('ERROR', reason);
                self.currentIn = '--';
            });
        },
        getCurrentOut: function() {
            /**
             * use card's getData api to get the temperature data
             * using the URL from context
             **/
            var self = this;
            // this.getData(this.context.urls['weather-data'],{headers: {'my-header-name': 'my-header-value'}}).then(function(data) {
            this.getData(this.context.urls[3].url).then(function(data) {
                // following data structure from  http://api.wunderground.com/
                self.currentOut = data.tags[0].results[0].values[0][1];
                self.outIcolors = self.getColor(self.currentOut);
            }, function(reason) {
                // on rejection
                console.error('ERROR', reason);
                self.currentOut = '--';
            });
        },
        getColor: function(value) {
            if (value <= 100)
                return "color:limegreen";
            if (value <= 200)
                return "color:yellow";
            if (value <= 300)
                return "color:orange";
            if (value <= 400)
                return "color:red";
            if (value <= 500)
                return "color:purple";
            return "color:brown";
        },
        behaviors: [px.card]
    });
</script>
